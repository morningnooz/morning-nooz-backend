# Morning Nooz Backend
MorningNooz ([https://morningnooz.com](url)) is a news aggregator service which uses LLMs to build summaries (with citations) for the news on any topic, at any level of detail.
![image](https://github.com/morningnooz/morning-nooz-backend/assets/47679108/362bcc15-5f12-482f-ab6e-4e7c5b19226c)
## Overview
Welcome to the Morning Nooz backend service! This README provides an overview of the backend setup for the Morning Nooz email service. The backend is structured around Azure Functions, making use of timer and queue triggers to process and dispatch personalized news summaries based on user-selected topics.

## Prerequisites
- Azure Functions environment setup.
- An Azure Storage account.
- SendGrid account for email dispatch.

## Environment Setup
Ensure that you have the following environment variables set:
- `ENV`: Set to `development` for development environment.
- `STORAGE_CONNECTION`: Connection string for Azure Storage account.
- `SENDGRID_API_KEY`: API key for SendGrid.
- `OPENAI_API_KEY`: API key for OpenAI.
- `BING_APIM_KEY`: API key for Bing News Search.
- `SENDER_EMAIL`: Email address of the sender: `Morning Nooz <morning.nooz@gmail.com>`.
- `CRON_TIME`: Cron string to set the timer function (e.g. "0 12 * * * *")

## Installation
1. Clone the repository to your local environment.
2. Install Azure Functions Core Tools:
    ```bash
        # Using npm
        $ npm install -g azure-functions-core-tools@3 --unsafe-perm true
        
        # Using Brew
        $ brew tap azure/functions
        $ brew install azure-functions-core-tools@4
        # if upgrading on a machine that has 2.x or 3.x installed:
        $ brew link --overwrite azure-functions-core-tools@4
   ```
3. Create a virtual environment and activate it.
   ```bash
    $ python3 -m venv .venv
    $ source .venv/bin/activate
   ```
4. Install the required packages as specified in the `requirements.txt` file.
5. Set up environment variables as mentioned above.

## Functions

### Dispatch Function
- **Trigger**: Timer Trigger.
- **Schedule**: Executes at 4 PM server time (UTC) every day.
- **Description**: Queries the database for all users, checks if they have requested news summaries for the day, and queues the requests.

### Process Function
- **Trigger**: Queue Trigger (`process-queue`).
- **Description**: Processes each message in the queue, generating personalized news summaries and queuing them for email dispatch.

### Send Function
- **Trigger**: Queue Trigger (`send-queue`).
- **Description**: Sends the generated summaries via email using SendGrid.

## How It Works
1. **Dispatch**: Triggered automatically, it queues user requests for news summaries.
2. **Process**: Picks up each queued request, fetches news based on topics, and summarizes them.
3. **Send**: Takes the summaries and dispatches them via email to the respective users.

## Deployment
Deploy this backend to your Azure Functions environment. Ensure that the environment variables are correctly set in the Azure Functions configuration.

## Support
For any issues or feature requests, please open an issue in the GitHub repository.

---
Generated by Morning Nooz Team.
